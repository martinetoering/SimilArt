<!-- base.html -->

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>{% block title %}{% endblock %}</title>

	<!-- Bootstrap core CSS -->
	<link href="https://getbootstrap.com/docs/4.0/dist/css/bootstrap.min.css" rel="stylesheet">

	<!-- D3 package -->
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<style>
		p, .txt {  text-align: justify;
			 	text-justify: inter-word;
				}
	</style>

	<!-- Layout stylesheet -->
	<link rel="stylesheet" type="text/css" href="base.css">
	<style>
		body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
		
		svg {
		  background-color: #fffbef;
		}
		.circle-outline {
		  fill: none;
		  stroke: #dbdbdb;
		  stroke-width: 2;
		}
	  </style>
</head>
<body>
	<div class=test>
		<script>
			var svgwidth = 960
			var svgheight = 500

			var svg = d3.select("body").append("svg")
			  .attr("width", svgwidth)
			  .attr("height", svgheight)
			
			var image = {
			  size: 100
			}

			console.log(d3.select('svg').node().getBBox())
			
			var defs = svg.append("defs");
			
			// var clipPath = defs.append("clipPath")
			//   .attr("id", "clip")
			//   .append("rect")
			//   .attr("x", image.size)
			//   .attr("y", image.size)
			//   .attr("width", 100)
			//   .attr("height", 100);
			
			// var glow = defs.append("filter")
			// 	.attr("id", "glow");
			// glow.append("feGaussianBlur")
			//   .attr("class", "blur")
			//   .attr("stdDeviation", 3.5)
			//   .attr("result","coloredBlur");
			
			// var feMergeGlow = glow.append("feMerge");
			// feMergeGlow.append("feMergeNode")
			//   .attr("in","coloredBlur");
			// feMergeGlow.append("feMergeNode")
			//   .attr("in","SourceGraphic");
			
			var doctorUrl1 = "../../data/images/11027946.jpg",
				doctorUrl2 = "https://curbsideprophecies.files.wordpress.com/2007/08/davidolder.thumbnail.png",
				doctorUrl3 = "https://68.media.tumblr.com/avatar_fde0361fb75d_128.png",
				doctorUrl4 = "https://68.media.tumblr.com/avatar_91eba9afde80_128.png";
			
			appendDraggableImage(doctorUrl1, [70, 175]);
			appendDraggableImage(doctorUrl2, [310, 175]);
			appendDraggableImage(doctorUrl3, [550, 175]);
			appendDraggableImage(doctorUrl4, [20, 175]);
			
			function appendDraggableImage(url, position) {
			  var imageGroup = svg.append("g")
				  .datum({position: position})
				.attr("transform", d => "translate(" + d.position + ")");
		
			  var circleFill = imageGroup.append("rect")
				  .attr("class", "circle-fill")
				.attr("x", image.size)
				.attr("y", image.size)
				.attr("width", image.size)
				.attr("height", image.size)
				.attr("filter", "url(#glow");
		
			  var imageElem = imageGroup.append("image")
				.attr("xlink:href", url )
				.attr("x", image.size)
			 	.attr("y", image.size)
				.attr("height", image.size)
				.attr("width", image.size)
				.attr("clip-path", "url(#clip)");
			
			  var circleOutline = imageGroup.append("rect")
				.attr("class", "circle-outline")
				.attr("x", image.size)
				.attr("y", image.size )
				.attr("width", image.size)
				.attr("height", image.size);
		
			  imageGroup.call(d3.drag()
						.on("start", dragstarted)
						.on("drag", dragged)
						.on("end", dragended));
			  
			}
			
			function dragstarted(d) {
		//       d3.select(this).raise();
			  
		//       d3.select(this).select(".circle-outline")
		//       	.transition()
		//       	.attr("r", 1 + image.size / 3);
			  
		//       d3.select(this).select(".circle-fill")
		//       	.transition()
		//       	.attr("r", 1 + image.size / 3);
			  
		//       d3.select(this).select("image")
		//       	.attr("x", image.size / 6)
		//       	.attr("y", image.size / 6)
		//       	.attr("height", image.size * 2 / 3)
		//         .attr("width", image.size * 2 / 3)
			  
		//       clipPath.attr("r", image.size / 3)
			}
			
			function dragged(d) {
				var newX = d3.event.x - image.size * 1.5,
					newY = d3.event.y - image.size * 1.5; 
				
				xborder = d3.event.x
				if (xborder + image.size*0.5  > d3.selectAll('svg').attr('width')) {
					newX = d3.selectAll('svg').attr('width') - image.size*2
				} else if (xborder - image.size*0.5  < d3.selectAll('svg').attr('width')-d3.selectAll('svg').attr('width')){
					newX = - image.size
				}
				yborder = d3.event.y
				if (yborder + image.size*0.5  > d3.selectAll('svg').attr('height')) {
					newY = d3.selectAll('svg').attr('height') - image.size*2
				} else if (yborder - image.size*0.5  < d3.selectAll('svg').attr('height')-d3.selectAll('svg').attr('height')){
					newY = - image.size
				}
				
				d3.select(this)
					.attr("transform", "translate(" + (d.position = [newX, newY]) + ")");
			}
			
			function dragended(d) {
			  d3.select(this).lower();
			  
			}
			
		  </script>
	</div>
</body>
</html>
