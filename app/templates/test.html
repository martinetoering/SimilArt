<!-- base.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>{% block title %}{% endblock %}</title>

    <!-- Bootstrap core CSS -->
    <link href="https://getbootstrap.com/docs/4.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- D3 package -->
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <!-- Layout stylesheet -->
   <link rel="stylesheet" type="text/css" href="base.css">
    <style>
        p, .txt {  text-align: justify;
            text-justify: inter-word;
        }

        body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }

        svg {
            background-color: #fffbef;
        }
        .rect-outline {
            fill: none;
            stroke: #dbdbdb;
            stroke-width: 2;
        }
        .middle {
            fill: none;
            stroke: #dbdbdb;
            stroke-width: 2;
			background-color: none;
        }
        .rect-fill{
            fill:aqua;
            stroke:aquamarine;
            stroke-width: 2;
        }
        #container{
            width: 100%
        }
    </style>
</head>
<body>
<div id="container"></div>
</body>

<!-- Import dragable images code -->
<script src="../static/js/drag_imgs.js"></script>
<!-- Import set_center image function -->
<script src="../static/js/center_image.js"></script>
<!-- Imports for the backend connection + nearest neighbor querying -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
<script src="../static/js/nearest_neighbors.js"></script>

<script type="text/javascript">
    var svgwidth = 960;
    var svgheight = 500;

    var svg = d3.select("#container").append("svg")
        .attr("preserveAspectRatio", "xMinYMin meet")
        .attr("viewBox", "0 0 " + svgwidth + " " + svgheight);

    var image = {
        size: 100
    };

    var middle = svg.append("svg")
        .attr("x", svgwidth*0.25)
        .attr("y", svgheight*0.25)
        .attr("width", svgwidth*0.5)
        .attr("height", svgwidth*0.25);

	middle.append("rect")
		.attr("class", "middle")
		.attr("width", svgwidth*0.5)
		.attr("height", svgwidth*0.25);

	var center = middle.append("svg")
		.append("image")
			.attr("clip-path", "url(#clip)");

    var backbutton = svg.append("rect")
        .attr("class", "rect-fill")
        .attr("x", svgwidth*0.25 + svgwidth*0.025 )
        .attr("y", svgheight*0.25)
        .attr("width", svgwidth*0.025)
        .attr("height", svgwidth*0.025);

    var redobutton = svg.append("rect")
        .attr("class", "rect-fill")
        .attr("x", svgwidth*0.25)
        .attr("y", svgheight*0.25)
        .attr("width", svgwidth*0.025)
        .attr("height", svgwidth*0.025);

    backbutton.on('click', function() {
        console.log('go back to previous image');
    });
    redobutton.on('click', function() {
        console.log('redo images');
    });

    var test = svg.append("g")
        .datum({position: [0, 0], height: 35, width: 55})
        .attr("transform", d => "translate(" + d.position + ")");

    var randomizebutton = test.append("rect")
        .attr("class", "rect-fill")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", 50)
        .attr("height", 30)

    randomizebutton.on('click', function() {
        console.log('randomize all outside images');
    });

    var imgs_path = "static/subset/";

    var middle_image = 2005927;
    var n_neighbours = 5;

    var doctorUrl1, doctorUrl2, doctorUrl3, doctorUrl4, doctorUrl5, doctorUrl6, doctorUrl7, doctorUrl8;
    doctorUrl1 = doctorUrl2 = doctorUrl3 = doctorUrl4 = doctorUrl5 = doctorUrl6 = doctorUrl7 = doctorUrl8 = "0";

	set_center(center, middle_image);
    nearest_neighbors(middle_image, n_neighbours);


    const sleep = (milliseconds) => {
        return new Promise(resolve => setTimeout(resolve, milliseconds))
    }
    sleep(500).then(() => {
        nearest_neighbors(middle_image, n_neighbours);
        doctorUrls_locs = [[0, 0], [310, 280], [650, 280], [-50, 80], [400, 100], [460, 90], [500, 120], [550, 130]];
        var i;
        for (i = 1; i < nearest_ids.length; i++) {
            // doctorUrls.concat(imgs_path + nearest_ids[1].toString() + ".jpg");
            console.log(imgs_path + nearest_ids[i].toString() + ".jpg");
            console.log(doctorUrls_locs[i]);
            appendDraggableImage(imgs_path + nearest_ids[i].toString() + ".jpg", doctorUrls_locs[i]);
        }
        console.log("test before nn");
        console.log(nearest_ids);

        console.log("test ctrl");

        var data = {{ data |safe }};
        var available_ids = {{ available_ids |safe }};

        console.log(available_ids)
    })
</script>

<script type="text/javascript">
	nearest_neighbors(2005927, 10);
	console.log(nearest_ids);
</script>
</html>
